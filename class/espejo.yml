parameters:
  espejo:
    namespace: syn-espejo
    git_tag: master
    images:
      espejo:
        image: docker.io/vshn/espejo
        tag: v0.0.4
    watch_namespace: ""
    cluster_role_rules:
    # Required for operator to function
    - apiGroups:
      - ""
      resources:
      - namespaces
      verbs:
      - get
      - list
      - watch
    - apiGroups:
      - sync.appuio.ch
      resources:
      - '*'
      verbs:
      - '*'
    # Required to sync objects
    - apiGroups:
      - ""
      resources:
      - services
      - endpoints
      - events
      - configmaps
      - secrets
      - pods
      verbs:
      - "*"
    - apiGroups:
      - networking.k8s.io
      resources:
      - networkpolicies
      verbs:
      - "*"
    - apiGroups:
      - extensions
      resources:
      - networkpolicies
      verbs:
      - "*"


  kapitan:
    dependencies:
      - type: https
        source: https://raw.githubusercontent.com/vshn/espejo/${espejo:git_tag}/deploy/crds/sync_v1alpha1_syncconfig_crd.yaml
        output_path: dependencies/espejo/manifests/${espejo:git_tag}/crds/sync_v1alpha1_syncconfig_crd.yaml
    compile:
      - output_path: espejo/00_crds/
        input_type: copy
        input_paths:
          - espejo/manifests/${espejo:git_tag}/crds/
      - input_paths:
          - espejo/component/main.jsonnet
        input_type: jsonnet
        output_path: espejo/
